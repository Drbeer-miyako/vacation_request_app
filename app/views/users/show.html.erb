<%= render partial: "header", locals: { user: @user } %>


    <div class="changeable-holiday">
          <% if RemainingHoliday.exists?(user_id: @user.id) %> 
               <h3><%= @user.user_name %>さん  残り  <%= @r.changeable_days %>日と<%= @r.changeable_time %>時間  (申請分を差し引いた取得可能時間)</h3> 
          <% end %>
     </div>


     <div class="r-holiday">
               <h3>今年度付与分の有給休暇</h3> 
     </div>
     <% if RemainingHoliday.exists?(user_id: @user.id) %>
          <table class="request-table">
               <tr>
                    <th class="detail-item"><%= "入社年月日" %></th>
                    <th class="detail-item"><%= "有効期間" %></th>
                    <th class="detail-item"><%= "昨年度繰越分" %></th>
                    <th class="detail-item"><%= "今年度付与分" %></th>
                    <th class="detail-item"><%= "合計" %></th>
                    <th class="detail-item"><%= "勤務時間の属性" %></th>
                    <th class="detail-item"><%= "備考" %></th>
                    <th class="detail-item"><%= "時間単位の残時間" %></th>
               </tr> 
               <div class="formats">
                    <tr>
                         <td class="detail-value"><%= "" %><%= @r.joining_date %></td>
                         <td class="detail-value"><%= @r.effective_period_start %>  〜
                                                  <%= @r.effective_period_end %></td>
                         <td class="detail-value"><%= "" %><%= @r.last_year_days %>日
                                                  <%= "" %><%= @r.last_year_time %>時間</td>
                         <td class="detail-value"><%= @r.this_year_days %>日</td>
                         <td class="detail-value"><%= "" %><%= @r.total_days %>日
                                                  <%= "" %><%= @r.total_time  %>時間</td>  
                         <td class="detail-value"><%= @r.working_hours %></td>
                         <td class="detail-value"><%= @r.reason %></td>
                         <td class="detail-value">残り<%= @r.time_limit %>時間</td>
                    </tr>
               </div>
          </table>
     <% else %> 
          <div class="if_not_exist">
               <h4>有給休暇はまだ付与されていません</h4>
               <div class="header-button">
                    <%= link_to "有給休暇を付与する", user_remaining_holiday_index_path(user_id: @user.id) %>
               </div> 
          </div>
     <% end %> 
  
     <div class="r-holiday">
               <h3>申請した有給休暇</h3> 
     </div>

<% if @holidays.exists? %> 
     <% @holidays.each do |f| %> 
          <%= link_to holiday_path(f.id), method: :get do %>
               <table class="request-table">
                    <tr>
                         <th class="detail-item"><%= "申請日" %></th>
                         <th class="detail-item"><%= "取得日" %></th>
                         <th class="detail-item"><%= "取得日数" %></th>
                         <th class="detail-item"><%= "時〜時" %></th>
                         <th class="detail-item"><%= "取得時間" %></th>
                         <th class="detail-item"><%= "事由" %></th>
                         <th class="detail-item"><%= "残日数" %></th> 
                         <th class="detail-item"><%= "残時間" %></th> 
                    </tr>
                    <div class="formats">
                         <tr>
                              <td class="detail-value"><%= f.created_at.strftime('%Y/%m/%d') %></td>
                              <td class="detail-value"><%= "" %><%= f.application_date.strftime('%Y/%m/%d') %>
                              <td class="detail-value"><%= f.acquisition_days %></td>
                              <% if f.holiday_time_start.nil? %> 
                                   <td class="detail-value"><span>ーー</span></td>
                              <% else %>
                                   <td class="detail-value"><%= "start " %><%= f.holiday_time_start.strftime('%H') %>
                                                       <%= "〜end " %><%= f.holiday_time_end.strftime( "%H" ) %></td>
                              <% end %> 
                              <% if f.acquisition_time.nil? %> 
                                   <td class="detail-value"><span>ーー</span></td>
                              <% else %>
                                   <td class="detail-value"><%= "start " %><%= f.acquisition_time %>時間</td>
                              <% end %>
                              <td class="detail-value"><%= f.reason %></td>
                              <td class="detail-value"><%= f.day_record  %>日</td>
                              <td class="detail-value"><%= f.time_record %>時間</td>
                         </tr>
                    </div>
               </table>   
          <% end %>
     <% end %>
<% else %>
     <div class='menber_name'>
          <h4>有給休暇の申請はまだありません</h4>
     </div>
<% end %>  


     <div class="r-holiday">
               <h3>申請した週休休暇の変更</h3> 
     </div>

<ul class='item-contents'>
     <div class='item-info'>   
          <% if @week_holidays.exists? %> 
               <% @week_holidays.each do |f| %>
                    <% if WeekHolidayChange.where(id: f.id, user_id: @user.id).exists?%>
                         <%= link_to week_holiday_change_path(f.id), method: :get do %>
                              <table class="request-table">
                                   <tr>
                                        <th class="detail-item"><%= "名前" %></th>
                                        <th class="detail-item"><%= "申請日" %></th>
                                        <th class="detail-item"><%= "週休日" %></th>
                                        <th class="detail-item"><%= "変更日" %></th>
                                        <th class="detail-item"><%= "リーダー" %></th>
                                        <th class="detail-item"><%= "部長" %></th>
                                        <th class="detail-item"><%= "総務" %></th>
                                   </tr>
                                   <div class="formats">
                                        <tr>    
                                             <td class="detail-value"><%= f.user.user_name %></td>
                                             <td class="detail-value"><%= f.created_at.strftime('%Y/%m/%d') %></td>
                                             <td class="detail-value"><%= "" %><%= f.original_leave.strftime('%Y/%m/%d') %>
                                             <td class="detail-value"><%= f.original_leave.strftime('%Y/%m/%d') %></td>
                                        

                                             <% if WeekHCheck.exists?(week_holiday_change_id: f.id) %>
                                                  <% if WeekHCheck.exists?(week_holiday_change_id: f.id, position: "リーダー") %>
                                                       <% check = WeekHCheck.find_by(week_holiday_change_id: f.id, position: "リーダー") %>
                                                       <% if check.yes_no == "yes" %>
                                                                 <td class="detail-value"><span>✅</span><%= check.user.user_name %></td>
                                                       <% elsif check.yes_no == "no" %>
                                                                 <td class="detail-value"><span>❌</span><%= check.user.user_name %></td>
                                                       <% end %>
                                                  <% else %>
                                                       <td class="detail-value"><span>--</span></td>
                                                  <% end %>

                                                  <% if WeekHCheck.exists?(week_holiday_change_id: f.id, position: "部長") %>
                                                       <% check = WeekHCheck.find_by(week_holiday_change_id: f.id, position: "部長") %>
                                                       <% if check.yes_no == "yes" %>
                                                       <td class="detail-value"><span>✅</span><%= check.user.user_name %></td>
                                                       <% elsif check.yes_no == "no" %>
                                                       <td class="detail-value"><span>❌</span><%= check.user.user_name %></td>
                                                       <% end %>
                                                  <% else %>
                                                       <td class="detail-value"><span>--</span></td>
                                                  <% end %>         

                                                  <% if WeekHCheck.exists?(week_holiday_change_id: f.id, position: "システム管理者") %>
                                                       <% check = WeekHCheck.find_by(week_holiday_change_id: f.id, position: "システム管理者") %>
                                                       <% if check.yes_no == "yes" %>
                                                       <td class="detail-value"><span>✅</span><%= check.user.user_name %></td>
                                                       <% elsif check.yes_no == "no" %>
                                                       <td class="detail-value"><span>❌</span><%= check.user.user_name %></td>
                                                       <% end %>
                                                  <% else %>
                                                       <td class="detail-value"><span>--</span></td>
                                                  <% end %> 
                                             <% else %>
                                                  <td class="detail-value"><span>--</span></td>
                                                  <td class="detail-value"><span>--</span></td>
                                                  <td class="detail-value"><span>--</span></td>
                                             <% end %>  
                                        </tr>
                                   </div>
                              </table>
                         <% end %>
                    <% end %>
               <% end %>
          <% else %>
               <div class='menber_name'>
                    <h4>週休の変更申請はまだありません</h4>
               </div>
          <% end %>     
     </div>
</ul>